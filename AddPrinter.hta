<!doctype html>
    <head>
        <meta charset="utf-8">
        
        <title>Add Library Printers</title>
        
        <meta name="description" content="Add Library Printers">



	<SCRIPT Language="VBScript" type="text/vbscript" id="WindowResize">
		Const WINDOW_WIDTH = 700
		Const WINDOW_HEIGHT = 600
		window.offscreenBuffering = TRUE
		window.resizeTo WINDOW_WIDTH,WINDOW_HEIGHT
		window.moveTo (window.screen.width - WINDOW_WIDTH) / 2, (window.screen.height - WINDOW_HEIGHT) / 2
	</SCRIPT>

	<HTA:APPLICATION
  APPLICATIONNAME="NC Add Printers Wizard"
  VERSION="1.0"
  BORDER="dialog"
  ICON="addprinter.ico"
  SCROLL="auto"
  SCROLLFLAT="yes"
  SINGLEINSTANCE="yes"/>
	<SCRIPT LANGUAGE="VBScript">
'*****************************************************************
'Define Variables for campus, server path, rooms, printer names
'*****************************************************************

Dim wellandUNCpath
wellandUNCpath="\\wcprt03.local.niagarac.on.ca\"

Dim notlUNCpath
notlUNCpath="\\gcprt02.local.niagarac.on.ca\"

'Center the window on load
Dim intLeft
Dim intTop

'Printer Names, Define printers for rooms here.
' abbreviation prnt denotes printer
' lib denotes room
' wel denotes campus

' Should be a variable array but I can't get it to work. See http://www.w3schools.com/vbscript/vbscript_variables.asp

'Welland Library Printers
Dim prntwellib0
prntwellib0="LibraryBlack"
Dim prntwellib1
prntwellib1="LibraryColour"
Dim prntwellib2
prntwellib2="LibraryHP"
'NOTL Library Printers
Dim prntnotllib0
prntnotllib0="LRCBlack"
Dim prntnotllib1
prntnotllib0="LRCColour"
'NOTL Room N202
Dim prntnotln2020
prntnotln2020="N202Black"
Dim prntnotln2021
prntnotln2021="N202Colour"
Dim prntnotln2022
prntnotln2022="N202HP11x17"
Dim weinstalled
weinstalled = ""
'***************************************************************
'Begin network test to make sure user is on the correct domain.
'***************************************************************

		set objShell=CreateObject("WScript.Shell")
		strCommand="ping -n 1 127.0.0.1"
	    'strCommand="ping -n 1 wcprt03.local.niagarac.on.ca" TEMPORARILY DISABLED WHILE TESTING. TURN ON FOR PRODUCTION
		set objProc=objShell.Exec(strCommand)

		Do    
		 line = objProc.StdOut.ReadLine()
		 s = s & line & vbcrlf
		Loop While Not objProc.Stdout.atEndOfStream

		If InStr(s,"Reply from")=0 Then
			'*Not connected to NC Network
			MsgBox "You must be connected to the College's Wired or Wireless Networks (AirNC-Secure) to add printers.  Please connect and run the program again", vbExclamation, "Error"
			window.close()
		Else
			'Connected to NC Network (all is good)
		End if 
'**************************************************************************************
'End network Test and begin loading the UI.
'**************************************************************************************
		Sub Window_Onload
'**************************************************************************************************************
' Center window on load. Depends on HTA.ini which does not work with the .exe packaging but still interesting.
'**************************************************************************************************************
' 			window.offscreenBuffering = True
' 
'
'        		Const ForReading = 1
'        		Set objFSO = CreateObject("Scripting.FileSystemObject")
'       		Set objFile = objFSO.OpenTextFile("HTA.ini", ForReading)
'        		strContents = objFile.ReadAll
'        		objFile.Close

'        		arrContents = Split(strContents, ",")
'        		window.moveTo arrContents(0), arrContents(1)
'****************************************************************************************************************
' set cursor focus on load
			usernamebox.Focus ' Set the username box to the cursor immediately
			HiddenInstallMessage.Style.Display="none" ' Hide the installing wait message. 
'***************************
' Hide Comboboxes On Start
'***************************
			WELLANDrooms.Style.Display="none" ' Hide drop downs on load
			NOTLrooms.Style.Display="none" ' Hide drop downs on load
'***************************
' Hide Rooms On Start
'***************************
			WELLANDlibrary.Style.Display="none" 
			NOTLlibrary.Style.Display="none"
			NOTLN202.Style.Display="none"
'***************************
' For default printer list
'***************************
			strComputer = "."
 			Set objWMIService = GetObject("winmgmts:\\" & strComputer & "\root\cimv2")
 			Set colPrinters = objWMIService.ExecQuery("Select * From Win32_Printer")
       		For Each objPrinter in colPrinters
            	strPrinter = objPrinter.Name
            Set objOption = Document.createElement("OPTION")
            	objOption.Text = strprinter
            	objOption.Value = strPrinter
           		AvailablePrinters.Add(objOption)
        Next
		End Sub

  		Sub SetDefault
        		strPrinter = AvailablePrinters.Value
        	Set WshNetwork = CreateObject("Wscript.Network")
        		WshNetwork.SetDefaultPrinter strPrinter
        	Msgbox strprinter & " has been set as your default printer."
    	End Sub
'*************************************************************************************************
'Remember window position. Also depends on HTA.ini which doesn't work with .exe conversion. Pitty
'***********************************
' Sub Window_onBeforeUnLoad
'        intLeft = window.screenLeft
'        intTop = window.screenTop
'
'        Const ForWriting = 2
'        Set objFSO = CreateObject("Scripting.FileSystemObject")
'        Set objFile = objFSO.OpenTextFile("HTA.ini", ForWriting)
'        objFile.WriteLine intLeft & "," & intTop
'        objFile.Close
'End Sub
'*****************************************************************************************************

'*********************************************
'Select Campus Event
'*********************************************

' Show/Hide Buttons based on Room
	Sub selcampus
		If OptionCampus.Value = 0 Then
			NOTLrooms.Style.Display = "none"
			WELLANDrooms.Style.Display = "none"
		ElseIf OptionCampus.Value = 1 Then
			NOTLrooms.Style.Display = "inline"
			WELLANDrooms.Style.Display="none"
			WELLANDlibrary.Style.Display = "none"
		ElseIf OptionCampus.Value = 2 Then
			WELLANDrooms.Style.Display = "inline"
			NOTLrooms.Style.Display = "none"
			NOTLlibrary.Style.Display = "none"
			NOTLN202.Style.Display = "none"
		Else
			NOTLrooms.Style.Display="none"
			WELLANDrooms.Style.Display="none"
		End If
	End Sub
'**********************************************
'Select Room WELLAND
'**********************************************
	Sub selroomwel
		If OptionRoomWEL.Value = 0 Then
			WELLANDlibrary.Style.Display = "none"
		ElseIf OptionRoomWEL.Value = 1 Then
			WELLANDlibrary.Style.Display = "inline"
		Else
			WELLANDlibrary.Style.Display = "none"
		End If
	End Sub
'***********************************************
'Select Room NOTL
'***********************************************
	Sub selroomnotl
		If OptionRoomNOTL.Value = 0 Then
			NOTLlibrary.Style.Display = "none"
		ElseIf OptionRoomNOTL.Value = 1 Then
			NOTLlibrary.Style.Display = "inline"
		ElseIf OptionRoomNOTL.Value = 2 Then
			NOTLLibrary.Style.Display = "none"
			NOTLN202.Style.Display = "inline"
		Else 
			NOTLlibrary.Style.Display = "none"
			NOTLN202.Style.Display = "none"
		End If
	End Sub

'**********************************************
' Blackboard login options
'**********************************************
' Submit if enter key is pressed
		Sub passwordbox_OnKeyDown
			With document.parentWindow.event
				If .keycode = 13 Then
					Submit_onClick
				End If
			End With
		End Sub
'***********************************************
' Passing creds to variables to include NC\ and add printers via checkboxes
		Sub Submit_onClick
			sUserName = usernamebox.Value
			sPassword = passwordbox.Value
' Reload on failure to enter creds
			If sUserName = "" Or sPassword = "" Then
				MsgBox "You must enter a username and password. This program will now restart.", vbExclamation, "Error"
				Location.Reload(True)
			Else
				HiddenInstallMessage.Style.Display="inline" 
				sFullUsername = "nc\" & sUserName	
			
' ********************************************************************************************************************
' DEPRICATED INSTALL MESSAGE
' This hides the window contents and shows activity. We can probably do better with a scrollbar or something here. 			
'				theRest.Style.Visibility="hidden"
'				Install.Style.Visibility="visible"
'*********************************************************************************************************************


' COMMAND KEY IS A PROBLEM!!!!!!!!!!! Need to check CAMPUS before sending. 
				
				Set objShell = CreateObject("WScript.Shell")
					Return = objShell.Run("cmdkey /add:wcprt03.local.niagarac.on.ca /user:" & sFullUsername & " /pass:" & sPassword, 1, True)
				Set objNetwork = CreateObject("WScript.Network")
			End If


' Ryan needs to teach me how to rewrite these with cases or something taht makes more sense.
' Should this be inside its own subroutine?  
'******************************
' Welland Library Checkboxes
'******************************
				If ((LibraryBlack.Checked = False) And (LibraryColour.Checked = False) And (LibraryHP.Checked = False))  Then
					MsgBox "You must select at least one printer to install. The program will now restart.", vbExclamation, "Error"
					Location.Reload(True)
				Else
					If LibraryBlack.Checked = True Then
						objNetwork.AddWindowsPrinterConnection wellandUNCpath & prntwellib0
					End If
			
					If LibraryColour.Checked = True Then
						objNetwork.AddWindowsPrinterConnection wellandUNCpath & prntwellib1
					End If
			
					If LibraryHP.Checked = True Then
						objNetwork.AddWindowsPrinterConnection wellandUNCpath & prntwellib2
					End If
				End If

'********************************
' NOTL Library Checkboxes
'********************************

				If ((LRCBlack.Checked = False) And (LRCColour.Checked = False))  Then
					MsgBox "You must select at least one printer to install. The program will now restart.", vbExclamation, "Error"
					Location.Reload(True)
				Else
					If LRCBlack.Checked = True Then
						objNetwork.AddWindowsPrinterConnection notlUNCpath & prntnotllib0
					End If
			
					If LRCColour.Checked = True Then
						objNetwork.AddWindowsPrinterConnection notlUNCpath & prntnotllib1
					End If
				End If
'********************************
' NOTL N202 Checkboxes
'********************************

				If ((N202Black.Checked = False) And (N202Colour.Checked = False) And (N202HP11x17.Checked = False))  Then
					MsgBox "You must select at least one printer to install. The program will now restart.", vbExclamation, "Error"
					Location.Reload(True)
				Else
					If (N202Black.Checked = True) Then
						objNetwork.AddWindowsPrinterConnection notlUNCpath & prntnotln2020
					End If
			
					If N202Colour.Checked = True Then
						objNetwork.AddWindowsPrinterConnection notlUNCpath & prntnotln2021
					End If
			
					If N202HP11x17.Checked = True Then
						objNetwork.AddWindowsPrinterConnection notlUNCpath & prntnotln2022
					End If
				End If
'*******************************************************
' Printer Installation Success
'*******************************************************
					MsgBox "Printer added successfully.", vbInformation, "Success"
					
					'computerSleep(1)
					End Sub
' Not really sure what this part of the script is doing exactly. It's waiting for the printers to install maybe?
'		Sub computerSleep(seconds)
'			Set objShell = CreateObject("Wscript.Shell")
'			cmd = "%COMSPEC% /c ping -n " & 1 + seconds & " 127.0.0.1>nul"
'			objShell.Run cmd,0,1
'		End Sub
'*******************************************************
' Delete NC printers or network printers.  NOT WORKING**
'********************************************************
	'	Sub DELPRINTERS
	'		strComputer = "."
	'		Set objWMIService = GetObject("winmgmts:\\" & strComputer & "\root\cimv2")
'
'			Set colInstalledPrinters =  objWMIService.ExecQuery _
'			("Select * from Win32_Printer Where Network = TRUE")
'
'			For Each objPrinter in colInstalledPrinters
'			objPrinter.Delete_
'			Next
'		End	Sub

		</SCRIPT>

		<style>
/* 
http://meyerweb.com/eric/tools/css/reset/ 
v2.0 | 20110126
License: none (public domain)
*/

/* RESET CSS BEGIN */
html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed, 
figure, figcaption, footer, header, hgroup, 
menu, nav, output, ruby, section, summary,
time, mark, audio, video {
	margin: 0;
	padding: 0;
	border: 0;
	font-size: 100%;
	font: inherit;
	vertical-align: baseline;
}
/* HTML5 display-role reset for older browsers */
article, aside, details, figcaption, figure, 
footer, header, hgroup, menu, nav, section {
	display: block;
}
body {
	line-height: 1;
}
ol, ul {
	list-style: none;
}
blockquote, q {
	quotes: none;
}
blockquote:before, blockquote:after,
q:before, q:after {
	content: '';
	content: none;
}
table {
	border-collapse: collapse;
	border-spacing: 0;
}
/* END RESET CSS END */


/* BEGIN CSS STYLE BEGIN */

/* FORM STYLE */

		.widthTextBox {
			width: 40%;
			}
select
{
width: 35%;
border-radius: 0px;
border: 1px solid #CCC;
font-weight: 200;
font-family: Verdana;
box-shadow: 1px 1px 5px #CCC;
}
/* TEXT STYLE */
		h1 {
			position: Fixed;
			font-family:;
			padding-left 2%;
			padding-top 20px;
			font-size: 400%;
			}
		h2 {
			position: Fixed;
			font-family:;
			font-size: 200%;
			text-algin: right;
			margin-top: 11%;
			margin-left: 20%;
			}
		h4 {
			font-family:"Georgia,serif";
			letter-spacing: 1px;
			padding-bottom: 7px;
			}

		.center {text-align:center;}
		.left  {text-align:left;}
		.right {text-align:right;}
		.bold{font-weight:600;}
/* BACKGROUND STYLE */
		.logo{
			position: relative;
			width: 20%;
			margin-left: 1%;
			margin-top: 1%;
			margin-bottom: 1%
			}
		.bgBlue {
		  background-color:#0073CF; 
		  color:#FFF;
		  }
		 .topBorder 
		  border-color:black; 
		  border-top-style:solid;
		 }
		body {background-color: #FFF;}
/* WRAPPER STYLE */
        .wrapper {
			width: 100%;
			position: relative;
			border-width: 7px;
			border-color: black;
			border-bottom-style: solid;
			border-top-style: solid;
			padding-top: 5%;
			padding-bottom: 5%;
			}
		.leftcolumn {
			float:left;
			width: 50%
			position: fixed;
			}
		.rightcolumn {
			float:right;
			width: 50%;
			}
/* Margins */
		.leftmargin1 {
			margin-left: 1%;
			}
		.leftmargin2 {
			margin-left: 2%;
			}
		.leftpad52 {
			padding-left: 52%}
		.toppad10 {
			padding-top: 1%
		}
		
		</style>

	
    </head>

    <body>

	
		<div id="theRest">	
			<div>
				<img alt="Niagara College's Library Logo" class="logo" src="NC_Button.png">
				<h1>Libraries</h1>
				<h2>Printer Wizard</h2>
			</div>
			<div class="wrapper bgBlue">
				<div class="leftcolumn">
<!-- CAMPUS DROPDWON -->
					<div class="leftmargin1">
						<h4>1) Choose your Campus.</h4>
						<select size="1" name="OptionCampus" onChange="selcampus" class="leftmargin1">
    						<option value="0">Choose Campus</option>
    						<option value="1">Niagara on the Lake</option>
    						<option value="2">Welland</option>
						</select>
					</div>
					<br>
<!-- WELLAND ROOMS DROPDOWN -->
					<div ID="WELLANDrooms">
						<h4 class="leftmargin1">2) Choose your Room</h4>
						<select size="1" name="OptionRoomWEL" onChange="selroomwel" class="leftmargin2">
							<option value="0">Choose Room</option>
							<option value="1">Library</option>
						</select>
					</div>
					<div ID="NOTLrooms" class="leftmargin1">
						<h4 class="leftmargin1">2) Choose your Room</h4>
						<select size="1" name="OptionRoomNOTL" onChange="selroomnotl" class="leftmargin2">
							<option value="0">Choose Room</option>
							<option value="1">Library</option>
							<option value="2">N202</option>
						</select>
					</div>
                    <br>
<!-- WELLAND Library Printers -->

					<div ID="WELLANDlibrary">
					<br>
						<h4 class="leftmargin1"> Choose your Welland library Printer(s)</h4>
						<input type="checkbox" name="LibraryBlack"> Library Black Printer<br>
						<input type="checkbox" name="LibraryColour"> Library Colour Printer<br>
						<input type="checkbox" name="LibraryHP"> LibraryHP 11x17
					</div>				
<!-- NOTL Library Printers -->

					<div ID="NOTLlibrary">
					<br>
						<h4 class="leftmargin1"> Choose your NOTL library Printer(s)</h4>
						<input type="checkbox" name="LRCBlack"> Library Black Printer<br>
						<input type="checkbox" name="LRCColour"> Library Colour Printer<br>
					</div>			
					<div ID="NOTLN202">
					<br>
						<h4 class="leftmargin1"> Choose your NOTL room N202 Printer(s)</h4>
						<input type="checkbox" name="N202Black">N202 Black Printer<br>
						<input type="checkbox" name="N202Colour">N202 Colour Printer<br>
						<input type="checkbox" name="N202HP11x17">N202 HP 11x17 Printer<br>
					</div>		
				</div>
<!-- RIGHT SIDE --> 

				<div>
					<div class="leftpad52">
						<h4>3) Enter your <span class="bold">BlackBoard</span> login:</h4>	
						<P class="bold">Username: <INPUT TYPE="TEXT" class="widthTextBox" NAME="usernamebox"></P>
						<P class="bold">Password:&nbsp; <INPUT TYPE="PASSWORD" class="widthTextBox" NAME="passwordbox"></P>
						<br>
						<h4>Choose Default Printer</h4>

<!-- DEPRICATED NOW WE INTELLIGENTLY GATHER INSTALLED PRINTERS
<select size="1" name="DefaultPrinter">
<option value="LibraryBlack">Library Black</option>
<option value="LibraryColour">Library Colour</option>
<option value="LibraryHP">LibraryHP 11x17</option></p>
</select> -->

						<select size="5" name="AvailablePrinters"width="300" style="width: 90%"></select>
						<br><br>
						<input type="button" value="Set as Default" onClick="SetDefault" >
					</div>
				</div>
			</div>
			<div class="center topBorder">
			&nbsp;
			<br>

<!-- Need to build out vbscript for delete button. --> 
				<INPUT TYPE="BUTTON" NAME="SUBMIT" VALUE="Install Library Printer(s)" title="Click this after selecting desired printers.">
				
				<!-- Delete printer button not working 
				<INPUT TYPE="BUTTON" ID="DELPRINTERS" NAME="DELPRINTERS" VALUE="Delete all network printers" title="Delete all network printers">
				-->
			
			</div>	
			
		</div>
		<div ID="HiddenInstallMessage" class="center toppad10">
			<h3 class="center toppad10">
				Installing Printer(s)..... 
				<br>
				Please be patient.
			</h3>
		</div>
    </body>
</html>